---
name: vlab
mgmt:
  network: custom_mgmt                # management network name
  ipv4-subnet: 172.100.100.0/24       # ipv4 range
  ipv6-subnet: ''

topology:
  nodes:
    r01:
      kind: linux
      image: quay.io/frrouting/frr:9.0.2
      network-mode: none
      binds:
        - opt/frr-zero/daemons:/etc/frr/daemons
        - opt/frr-zero/frr.conf:/etc/frr/frr.conf
        - opt/frr-zero/vtysh.conf:/etc/frr/vtysh.conf
    r11:
      kind: linux
      image: quay.io/frrouting/frr:9.0.2
      network-mode: none
      binds:
        - opt/frr-one/daemons:/etc/frr/daemons
        - opt/frr-one/frr.conf:/etc/frr/frr.conf
        - opt/frr-one/vtysh.conf:/etc/frr/vtysh.conf
    ixp-net:
      kind: bridge
    sw0:
      kind: bridge
    sw1:
      kind: bridge
    h00:
      kind: linux
      image: quay.io/karampok/snife:latest
      network-mode: none
      exec:
        - ip addr add 10.10.0.10/24 dev eth0
        - ip route add default via 10.10.0.1
      ports:
        - 55555:43555/udp
    k00:
      kind: k8s-kind
      network-mode: none
      startup-config: k00-config.yaml

    k00-control-plane:
      kind: ext-container
      network-mode: none
      exec:
        - ip addr add dev clab 10.10.1.101/24
    k00-worker:
      kind: ext-container
      network-mode: none
      exec:
        - ip addr add dev clab 10.10.1.102/24
    # k00-worker2:
    #   kind: ext-container
    #   network-mode: none
    #   exec:
    #     - ip addr add dev clab 10.10.1.103/24
    h10:
      kind: linux
      image: quay.io/karampok/snife:latest
      network-mode: none
      exec:
        - ip addr add 10.10.1.10/24 dev eth0
        - ip route add default via 10.10.1.1
  links:
    - endpoints: ["h00:eth0", "sw0:sw0-port2"]
    - endpoints: ["r01:eth1", "sw0:sw0-port0"]
    - endpoints: ["r01:eth0", "ixp-net:ixp-port0"]
    - endpoints: ["r11:eth0", "ixp-net:ixp-port1"]
    - endpoints: ["r11:eth1", "sw1:sw1-port1"]
    - endpoints: ["h10:eth0", "sw1:sw1-port2"]
    - endpoints: ["k00-control-plane:clab", "sw1:sw1-port101"]
    - endpoints: ["k00-worker:clab", "sw1:sw1-port102"]
      #   - endpoints: ["k00-worker2:clab", "sw1:sw1-port103"]
