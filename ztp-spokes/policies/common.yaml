---
apiVersion: ran.openshift.io/v1
kind: PolicyGenTemplate
metadata:
  name: "common"
  namespace: "ztp-common"
spec:
  bindingRules:
    common: "true"
  remediationAction: inform
  sourceFiles:
    - fileName: "MastersSchedulable.yaml"
      policyName: "config-cluster"
    - fileName: ReduceMonitoringFootprint.yaml
      policyName: "config-policy"
    # install and configure SR-IOV operator
    - fileName: SriovSubscriptionNS.yaml
      policyName: "install-operators"
    - fileName: SriovSupportedNicCM.yaml
      policyName: "install-operators-hack"
    - fileName: SriovSubscriptionOperGroup.yaml
      policyName: "install-operators"
    - fileName: SriovSubscription.yaml
      policyName: "install-operators"
      spec:
        channel: stable
        source: redhat-operators
    - fileName: metallb/ns.yaml
      policyName: "install-operators"
    - fileName: metallb/operatorGroup.yaml
      policyName: "install-operators"
    - fileName: metallb/subscription.yaml
      policyName: "install-operators"
    - fileName: metallb/instance.yaml
      policyName: "config-operators"
      spec:
        logLevel: debug
        speakerTolerations:
          - effect: NoSchedule
            key: sriov
            value: "true"
    # install NMState operator
    - fileName: nmstate/subscription.yaml
      policyName: "install-operators"
    - fileName: nmstate/ns.yaml
      policyName: "install-operators"
    - fileName: nmstate/operatorGroup.yaml
      policyName: "install-operators"
    - fileName: nmstate/instance.yaml
      policyName: "config-operators"
    # other networking config
    - fileName: RoutingViaHost.yaml
      policyName: "config-network"
    - fileName: AddAdditionalNetworks.yaml
      policyName: "config-network"
      spec:
        additionalNetworks:
          - name: macnet0
            namespace: default
            rawCNIConfig: '{ "cniVersion": "0.4.0", "name": "macnet0",
              "plugins": [ {"type": "macvlan", "master": "bond0", "mode": "bridge" },{
              "type": "tuning", "name": "tuning-arp" }] }'
            type: Raw
          - name: macnet1
            namespace: default
            rawCNIConfig: '{ "cniVersion": "0.4.0", "name": "macnet1",
              "plugins": [ {"type": "macvlan", "master": "bond0", "mode": "private" },{
              "type": "tuning", "name": "tuning-arp" }] }'
            type: Raw
