###PRE lab3
ssh lab3
echo '${{ secrets.PULL_SECRET }}' > .pull-secret.json
echo '${{ secrets.ARGO_GIT_KEY }}' > .github-argo
./sinfra --clean -auto-timeout 0s --continue-on-error
./sinfra --setupInfra -auto-timeout 0s
podman logs workstation
podman exec workstation bash -c '
  ./deploy-ocp.sh hub
  export KUBECONFIG=/share/hub/auth/kubeconfig
  openshift-install agent wait-for install-complete --log-level info --dir /share/hub
  oc get co && oc get clusterversion
'
echo "wget http://10.0.0.1:9000/hub/auth/kubeconfig -O ~/.kube/hub.yaml"
echo "curl -s http://10.0.0.1:9000/hub/auth/kubeadmin-\password | xsel --input --clipboard"
podman exec workstation bash -c '
  cd ./hub-config/
  ./install-acm.sh
  sleep 50
'
podman exec workstation bash -c '
  GITKEY_FILE=.github-argo ./hub-config/git-ssh-access.sh || true
  BRANCH=demo PULL_SECRET_PATH=.pull-secret.json ./hub-config/install-ztp.sh
'

###DEMO STARTS HERE
sudo wg-quick up lab3

https://openshift-gitops-server-openshift-gitops.apps.hub.eric.vlab/applications/openshift-gitops/clusters?view=tree
so the sync is working


git clone -b demo git@github.com:karampok/telco-ocp-lab.git
cd telco-ocp-lab
nvim ztp-spokes/sites/kustomization.yaml
git commit & push

https://openshift-gitops-server-openshift-gitops.apps.hub.eric.vlab/applications/openshift-gitops/clusters?view=tree
blocked
oc apply -k ~/5gc/

./bin/watch-ztp 5gc || echo ""
oc -n 5gc wait clusterdeployment 5gc --for=condition=Provisioned --timeout=5400s
oc get policies -A
oc -n ztp-install wait cgu 5gc --for=condition=Succeeded --timeout=5400s
